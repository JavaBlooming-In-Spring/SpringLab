# Filter vs Interceptor

> MVC2 강의를 듣다 보면, **인터셉터가 필터보다 훨씬 사용하기 좋다**고 말하고 있습니다.
> 
> 
> 필터와 인터셉터의 가장 큰 차이는 **디스패처 서블릿 이전에 시행되냐 이후에 시행되냐** 인 것 같은데, 이게 도대체 얼마나 큰 차이가 있길래 **굳이굳이 필터와 인터셉터라는 2가지 방식을 모두 가지고 있는 건지** 궁금합니다!
> 
> ### **요약**
> 
> 필터 vs 인터셉터 - 필터가 아직 쓰이는 이유
> 
> - 번외) 이왕 횡단 관심사에 대해 공부하는 김에 `AOP`도 함께 공부해보면 좋을 것 같습니다.

## 필터(Filter)란?

**필터는 J2EE 표준 스펙 기능으로, 디스패처 서블릿에 요청이 전달되기 전/후에 url 패턴에 맞는 모든 요청에 대해 부가작업을 처리할 수 있는 기능을 제공한다.** [디스패처 서플릿](https://mangkyu.tistory.com/18)은 스프링의 가장 앞단에 존재하는 프론트 컨트롤러이므로, 필터는 스프링 범위 밖에서 처리가 된다.

즉, 스프링 컨테이너가 아닌 톰캣과 같은 웹 컨테이너에 의해 관리가 되는 것이고, 디스패처 서블릿 전/후에 처리하는 것이다.

![image](https://user-images.githubusercontent.com/92802207/190859353-7453b121-b705-4aaf-a931-03bed57366fc.png)

## 인터셉터(Interceptor)란?

**인터셉터는 J2EE 표준 스펙인 필터와 달리, Spring이 제공하는 기술로써, 디스패처 서블릿이 컨트롤러를 호출하기 전과 후에 요청과 응답을 참조하거나 가공할 수 있는 기능을 제공한다.**

*즉, 웹 컨테이너에서 동작하는 필터와 달리 인터셉터는 스프링 컨텍스트에서 동작을 하는 것이다.*

디스패처 서블릿은 핸들러 매핑을 통해 적절한 컨트롤러를 찾도록 요청하는데, 그 결과로 실행 체인을 돌려준다. 그래서 이 실행 체인은 1개 이상의 인터셉터가 등록되어 있다면 순차적으로 인터셉터들을 거쳐 컨트롤러가 실행되도록 하고, 인터셉터가 없다면 바로 컨트롤러를 실행한다.

![image](https://user-images.githubusercontent.com/92802207/190859371-f8d54f29-b974-47ab-8513-b54090281fc8.png)

## 인터셉터와 AOP의 비교

인터셉터 대신에 컨트롤러들에 적용할 부가기능을 어드바이스로 만들어 AOP를 적용할 수도 있다. 

하지만

- 컨트롤러는 타입과 실행 메소드가 모두 제각각이라 포인터컷(적용할 메소드 선별)의 작성이 어렵다.
- 컨트롤러는 파라미터나 리턴 값이 일정하지 않다.
- AOP에서는 HttpServletRequest/Response 객체를 얻기 어렵지만, 인터셉터에서는 파라미터로 넘어온다.

## 필터 vs 인터셉터 차이와 용도

필터와 인터셉터는 각각이 관리되는 컨터에너와 Request/Response의 조작 가능 여부가 다르고, 그에 따라 용도가 다르다.

![image](https://user-images.githubusercontent.com/92802207/190859393-9fd9b87d-489b-4012-b782-1e4a76e4f2c2.png)

### 필터의 용도

필터에서는 기본적으로, **스프링과 무관하게 전역적으로 처리해야 하는 작업들**을 처리할 수 있다. (대표적으로는 보안 공통 작업이 있다.)

또한 필터는 이미지나 데이터의 압축이나, 문자열 인코딩과 같이 **웹 애플리케이션에 전반적으로 사용되는 기능을 구현**하기에 적당하다.

*필터는 다음 체인으로 넘기는 ServletRequest/ServletResponse 객체를 조작할 수 있다는 점에서 interceptor보다 훨씬 강력한 기술이다.*

### 인터셉터의 용도

인터셉터에서는 **클라이언트의 요청과 관련되어 전역적으로 처리해야 하는 작업**들을 처리할 수 있다. (대표적으로 세부적으로 적용해야 하는 인증이나 인가와 같이 클라이언트 요청과 관련된 작업 등이 있다.)

또한 필터와 다르게 HttpWervletRequest나 HttpServletResponse 등과 같은 객체를 제공받으므로, 객체 자체를 조작할 수는 없다. 대신 해당 객체가 내부적으로 갖는 값은 조작할 수 있으므로 **컨트롤러로 넘겨주기 위한 정보를 가공**하기에 용이하다.

*HttpServletRequest나 HttpServletResponse를 제공해주는 인터셉터는 클라이언트의 IP나 요청 정보들을 포함해 기록하기에 용이하다.*

## 최근에는 필터 역시 스프링 빈으로 등록 가능

[필터가 스프링 빈 등록과 주입이 가능한 이유(DelegatingFilterProxy의 등장)](https://mangkyu.tistory.com/221)
